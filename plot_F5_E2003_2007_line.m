clear,clc
close all
%%
in_path='E:\Paper\Lake_ET\ET_ICE_Cover\odata\Models\';
mo_path='E:\Paper\Lake_ET\ET_ICE_Cover\images\imges_v1\';
load([in_path,'Models_E_2003_2017'],'E_Simu_sum','E_Simu_sum_d','E_Simu_sum_u','E_Simu_ym','E_Simu_ym_d','E_Simu_ym_u');
E_S=[E_Simu_ym, E_Simu_sum];
E_Sd=[E_Simu_ym_d, E_Simu_sum_d];
E_Su=[E_Simu_ym_u, E_Simu_sum_u];
year=2003:2017;
%%
DataV=Box_Outlier_eliminating(E_S,0.5);
%%
       kyr =   -0.001748;  %(-0.01316, 0.009668) R=-0.30; RMSE=0.09
       byr =        5.43;  %(-17.51, 28.37)
% kyr =  -0.0002366;  %(-0.01384, 0.01337) R=-0.10; RMSE=0.11
% byr =       2.406;  %(-24.95, 29.76)
       kfr =    0.001409;  %(-0.005164, 0.007981) R=-0.26; RMSE=0.05
       bfr =      -0.907;  %(-14.11, 12.3)

% kfr =  -0.0007834;  %(-0.01392, 0.01235) R=0.43; RMSE=0.10
% bfr =        3.51;  %(-22.9, 29.91)
       kcr =    -0.00893;  %(-0.02846, 0.0106) R=-0.17; RMSE=0.14
       bcr =       19.75;  %(-19.49, 59)

% kcr =    -0.00543;  %(-0.03308, 0.02222) R=-0.18; RMSE=0.21
% bcr =       12.75;  %(-42.83, 68.32)

kys =     -0.1921;  %(-4.958, 4.574) R=-0.34; RMSE=36.92
bys =        1095;  %(-8485, 1.067e+04)

kfs =       1.883;  %(-1.382, 5.148) R=-0.15; RMSE=25.29
bfs =       -3261;  %(-9823, 3301)

kcs =     -0.5157;  %(-2.275, 1.244) R=0.33; RMSE=12.26
bcs =        1212;  %(-2325, 4750)






%%


for i = 1: size(E_S,2)
    if i==2
        [x1,yfit1,fx1,fy1,p1,r1,Pv1]=SigLine(year',E_S(:,i),1);
    else
[x1,yfit1,fx1,fy1,p1,r1,Pv1]=SigLineE(year',E_S(:,i),1);
    end
Yfit1(:,i)=yfit1; Fy1(:,i)=fy1; K1(:,i)=p1(1); B1(:,i)=p1(2);
R1(:,i)=r1; P1(:,i)=Pv1;
Fy2(:,i)=[E_Sd(:,i);flipud(E_Su(:,i))];
end
%% plot
H1=figure(1);
set(H1,'position',[ 0.0010    0.0010    1.5360    0.7896]*1000);
name={'Growing Season','Spring','Summer','Autumn'};
ha = tight_subplot(2,3,[.11 .06],[.08 .05],[.07 .06]); % 行间隔，列间隔，距下边界，上边界，左边界，右边界
for j = 1: size(E_S,2)
    axes(ha(j));
    hp=plot(year,E_S(:,j),'o','color',[100 149 237]./255,'MarkerFaceColor',[100 149 237]./255,'MarkerEdgeColor','none');
    set(hp,'LineStyle','-','color',[100 149 237]./255,'LineWidth',1.2);
    hold on
    fill(fx1,Fy2(:,j),[100 149 237]./255,'FaceAlpha',0.2,'EdgeAlpha',1,'EdgeColor',[100 149 237]./255,'LineStyle','--');   
    hold on
    h2=plot(year,Yfit1(:,j),'r-','LineWidth',1.2);
    hold on
    fill(fx1,Fy1(:,j),[244 164 96]./255,'FaceAlpha',0.2,'EdgeAlpha',1,'EdgeColor',[244 164 96]./255,'LineStyle','--');          
    xlabel('\fontname{Arail}Year ');
    xlim([2003,2017]);
set(gca,'fontsize',16,'Fontname','Arail','FontWeight','bold');
set(get(gca,'XLabel'),'Fontname','Arail','FontSize',16,'FontWeight','bold');
set(gca,'linewidth',1.2);
end
for i = 1:3
  axes(ha(i));  
  ylabel('\fontname{Arial}Simulate E (mm d^-^1)', 'fontsize',16,'FontWeigh','bold');  
    axes(ha(i+3));  
  ylabel('\fontname{Arial}Simulate E (mm yr^-^1)', 'fontsize',16,'FontWeigh','bold');   
end
%%
% str1='\fontname{Times New Roman}(GNDVI)';
% str2='\fontname{宋体}(趋势线)';
legend1 = legend([hp,h2],{'E','Trend Line'});
set(legend1,...
    'Position',[0.0844546339611094 0.361439329478737 0.104557293367882 0.0725683906520391],...
    'Interpreter','none',...
    'FontName','Arail',...
    'FontSize',16,...
    'EdgeColor','none');
%%
% 创建 textbox
annotation(H1,'textbox',...
    [0.255427083333331 0.901722390431887 0.0585937512417635 0.0400202640767277],...
    'String','Annual',...
    'LineStyle','none',...
    'FontWeight','bold',...
    'FontSize',14,...
    'FontName','Arial');
% 创建 textbox
annotation(H1,'textbox',...
    [0.565843749999997 0.901722390431887 0.060677084624767 0.0400202640767277],...
    'String','Ice-free',...
    'LineStyle','none',...
    'FontWeight','bold',...
    'FontSize',14,...
    'FontName','Arial');
% 创建 textbox
annotation(H1,'textbox',...
    [0.851260416666663 0.901722390431887 0.0851562518750625 0.0400202640767278],...
    'String','Ice-covered',...
    'LineStyle','none',...
    'FontWeight','bold',...
    'FontSize',14,...
    'FontName','Arial');
%%
% 创建 textbox
annotation(H1,'textbox',...
    [0.0254791666666642 0.953900708398562 0.0294270838797093 0.0471124628273791],...
    'String','a',...
    'LineStyle','none',...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Arial');
% 创建 textbox
annotation(H1,'textbox',...
    [0.336156249999997 0.953900708398562 0.0294270838797093 0.0471124628273791],...
    'String','b',...
    'LineStyle','none',...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Arial');
% 创建 textbox
annotation(H1,'textbox',...
    [0.646833333333329 0.953900708398562 0.0294270838797093 0.0471124628273791],...
    'String','c',...
    'LineStyle','none',...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Arial');
% 创建 textbox
annotation(H1,'textbox',...
    [0.0254791666666642 0.469098276787622 0.0294270838797093 0.0471124628273791],...
    'String','d',...
    'LineStyle','none',...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Arial');
% 创建 textbox
annotation(H1,'textbox',...
    [0.336156249999997 0.469098276787622 0.0294270838797093 0.0471124628273791],...
    'String','e',...
    'LineStyle','none',...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Arial');
% 创建 textbox
annotation(H1,'textbox',...
    [0.646833333333329 0.469098276787622 0.0294270838797093 0.0471124628273791],...
    'String','f',...
    'LineStyle','none',...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Arial');
%% 保持图片
set(gcf,'PaperPositionMode','auto');
print('-djpeg', '-r600', [mo_path, 'F5_Models_ E2003_2017']);


